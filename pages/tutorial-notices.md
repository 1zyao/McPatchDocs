# 注意的事项

## 移动客户端程序的位置

客户端程序McPatchClient.jar的位置不是固定的，因为有自动定位功能的存在，客户端程序无论放在哪个子目录下面，更新文件时会始终以.minecraft所在的目录开始计算，不受客户端程序自己的位置的影响

在移动客户端程序时，除了移动jar文件以外，还需要带着`mc-patch-version.txt`和`config.yml`一起移动，以确保程序能正确读取配置文件和版本号文件

如果你要禁用这个自动定位的机制，可以在配置文件里调整`base-path`选项，在修改前请务必阅读配置文件注释，知晓修改这个选项的后果

## 有时候文件会更新失败

客户端的某个文件在更新之前，如果文件内容被人为修改过或者直接删除了，会导致客户端程序跳过对此文件的更新

这是文件更新机制所致的，服务端打包更新包时不会记录文件完整内容，而是根据旧文件内容+新文件内容进行对比，生成差异文件，或者说补丁文件。当更新包被下载到客户端后，需要原来的旧文件+补丁文件（差异文件）才能生成（更新成）新文件的，如果旧文件被修改或者删除，仍要强行进行文件更新会导致文件数据错乱，这种情况是无法进行任何更新的，所以程序在遇到这种情况时会跳过这些不能更新的文件，但其它文件正常更新不受影响

正因为有这个机制的存在，玩家自己添加删除修改的文件不会被更新系统覆盖，即使遇到更新也不会改动，可以保留玩家自己的个性化定制数据

这些不能更新的文件在所有的未来版本里都会跳过更新（因为文件没有受到更新，文件校验会一直对不上），直到服务端在某个未来版本里对此文件进行了删除操作才会打破这个循环，重新加入更新

这个机制导致了玩家不能“手贱”修改文件，否则会导致这个文件从此之后的更新全部失败，此时建议让玩家重新下载一遍客户端，或者你发一个“正确”文件过去让它替换

## 版本发错了怎么办

版本号一旦发布就不能撤回，撤回可能会导致客户端某些文件更新永久更新失败，而且这种问题很难发现和调试。你应该额外再发布一个版本来替代撤回

如果你100%确定刚发布的错误版本没有任何人下载的话，可以使用以下方法来撤回：

1. 打开`public`目录下的版本列表文件：`mc-patch-versions.txt`或`versions.txt`，将错误版本那一行连带后面所有的行都删除掉（**这一行前面部分的千万别改动**）
2. 比如123456这6个版本中，4出了问题，就要撤回456三个版本，就在版本列表文件里删除456这三行，使3这一行成为文件末尾
3. 接着删除public目录下456这三个版本对应的json文件和bin文件
4. 最后运行管理端，在主菜单输入（1.0版本输入`bv`，1.1版本输入`revert`）进入还原菜单，恢复workspace目录和history目录的内容。恢复所需的时间和已有版本的数量成正比，如果版本非常多，过程可能会非常慢
5. 这样就回退到了你发布错误版本号之前的状态了
6. 如果你不能100%保证没有任何人下载过这个错误的版本，就不要撤回版本，否则那个人会出现各种各样的奇奇怪怪的问题

## 不小心修改了history目录

如果你不小心修改了history目录下的内容，可以在主菜单输入（1.0版本输入`bv`，1.1版本输入`revert`）进入还原菜单来同时还原workspace目录和history目录，注意使用此命令会丢失已有修改，注意备份重要数据

恢复所需的时间和已有版本的数量成正比，如果版本非常多，过程可能会非常慢

## 加密配置文件和版本号文件

> 此特性仅McPatchClient 1.0.11或更高版本支持

这里的加密不是真的加密，而是将内容以base64编码后以非明文保存，不能起到绝对的安全防护的作用

加密配置文件（config.yml）：将整个配置文件内容复制后使用Base64进行编码，然后删掉原有内容，将编码后的内容粘贴进去，然后在文件的开头添加一个英文冒号`:`用来告诉程序配置文件被“加密”了，使用之前要先“解密”

加密版本号文件（mc-patch-version.txt）：将整个版本号文件内容复制后使用Base64进行编码，然后删掉原有内容，将编码后的内容粘贴进去，然后在文件的开头添加一个英文冒号`:`用来告诉程序配置文件被“加密”了，使用之前要先“解密”

注意：配置文件和版本号文件“加密”后，不会影响日志文件里的账号密码信息的显示，如果在意，可以在配置文件里禁用日志文件生成

## 避免仅修改文件名大小写

如果有个文件叫abc.jar你将其改名成Abc.jar然后打包，你增加或者删除点内容，改成Abc1.jar都没事，改成Ab.jar也可以，但唯独abc.jar会出问题。客户端遇到这种文件时，会直接删掉Abc.jar，而不下载abc.jar，导致这个文件永久丢失更新状态

这个问题的原因是文件系统不区分文件名大小写造成的，可以看做是软件本身的bug，但是考虑到很少有人这样去改文件名，因此这个问题迟迟没有修复。所以在使用管理端时要人为避免这种仅修改大小写的行为

## 版本号并非判断新旧的依据

版本号只是一个普通的标签，是给人类看的，不作为任何判断版本前后的依据，程序不会解析对比版本号的文字。

实际版本的新旧顺序是按你打包的时间来判断的，后打的版本总是比先打的版本要新

版本号并没有规定一定要往高走，也可以往低走。就是说你可以从1.5版本更新到1.4版本。这算更新而非回退，因为1.4版本晚于1.5版本打包，所以被认为是较新的版本

至于哪个版本更新，哪个版本更旧？可以亲自打开版本列表文件看看（**注意只能看不能改**）

## 修复客户端的文件

使用此功能需要1.1版本或者更高版本的管理端和服务端

从1.1版本开始，更新包开始划分为增量包和全量包两种。最先创建的第一个版本永远是全量包，后面创建的永远是增量包。无论客户端文件损坏成什么样，只要能运行McPatch就可以利用全量更新包机制把整个客户端重新安装一次

方法很简单：删除客户端的版本号文件即可。客户端会自动重头开始下载所有的更新包并依次安装

需要注意：

1. 这个功能如果在配置文件里被手动关闭了，是不起作用的（但此功能默认是开启状态）
2. 完整下载一边所有的更新包会非常消耗时间，也非常消耗流量和带宽
3. 文件的修复范围仅限于加入过更新的文件（也就是工作空间目录(workspace)里曾经出现的文件和目录）

