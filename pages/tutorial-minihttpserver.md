# 使用自带的服务端

McPatch的服务端是分离架构，打包版本和启动服务端是分开进行的，以方便大佬们魔改出自己的更新系统

## 启动服务端

如果你是小白，非常建议使用自带的服务端，也就是`MiniHttpServer`，开箱即用，无需任何配置

启动自带的服务端很简单，在之前的教程中我们已经编写好了启动脚本，此时直接双击`httpserver.bat`文件就可以启动自带服务端了

启动成功后服务端会自动输出一个叫`API地址`的东西，我们需要复制这个地址，后面会有用

## 本地访问测试

接着打开你电脑上的浏览器，把`API地址`粘贴到地址栏并打开。如果浏览器显示`FORBIDDEN: Directory is unable to show`就表示程序启动成功了

如果你是在服务器上以远程连接的方式安装McPatch服务端，那么就需要打开服务器上的浏览器进行访问，而不是自己电脑上的，因为这一步叫本地访问测试，目的是测试自带服务端是否启动成功

这一步测试大家基本上都会成功，如果失败记得看看是不是6600端口冲突了，换个端口试试

## 远程访问测试

接着是远程访问测试，这一步很重要，因为你安装McPatch最终是要发出去给玩家用的，而不是给自己用的

如果此时你的McPatch仍然安装在自己电脑上，打算等到调试好之后再传到服务器上去，那么这一步测试的操作可以推迟到你传到服务器上之后再去做

如果你是直接在服务器上McPatch，那么现在就要做，以确保你的服务器端口是通的，玩家可以正常访问到更新服务器

远程访问测试过程不复杂，将McPatch的端口（6600）映射出去之后，或者放行防火墙，安全组之后，将`API地址`里的本地IP地址替换为你外网的IP或者域名再浏览器进行访问就行了，注意此时要用你自己电脑上的浏览器，而不能用服务器上安装的

正常情况下，显示`FORBIDDEN: Directory is unable to show`字样的时间应该小于5秒，如果多次测试都大于5秒，则需要排查网络是否稳定（自己电脑的网络和服务器网络都要排查）

如果你的计算机网络相关知识比较薄弱，这一步大概率会出问题，出问题之后先看看是什么类型的错误，然后查一下[常见问题解答](faq.md)是什么原因引起的。你可以百度解决，也可以到官方交流群里请求大佬们的帮助

到这里服务端就算安装成功了，现在可以前往下一章节开始安装客户端了。下面有一些来自大佬们的经验，可以看一看，当然不看也没关系，不会对后面的内容有任何影响

## 一些经验

### 备案问题

在大陆公有云部署一般都会需要 ICP 备案，如果没有就搭建不了更新。此时可以选择购买大陆以外的服务器，比如HK的服务器。或者使用HTTPS协议进行更新，可以有概率绕过这个检测（不一定100%成功）。

如果你选择樱花映射，请选择海外节点，因为国内节点同样要求要备案，不备案会一刀切阻断所有https/tls流量

如果有技术条件也可以走sftp协议进行更新，这样就完全没有备案的问题了，sftp协议可能会有安全问题，一般不推荐用实际服务器环境做sftp更新，推荐使用docker开启sftp服务器，安全会有保障的多
