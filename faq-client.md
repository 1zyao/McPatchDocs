## 常见问题解答

一些常见的问题都列举在这里了，希望对你有帮助。 

### 更新时窗口无响应卡死或者内容丢失

`影响范围`：客户端全版本

`问题原因`：目前未知

`解决方法`：在配置文件里把主题禁用即可`disable-theme: true`

### Error opening zip file or JAR Manifest missing

```
Error occurred during initialization of VM
agent library failed to init: instrument

Error opening zip file or JAR Manifest missing: McPatchClient.jar
```

`影响范围`：客户端全版本

`问题原因`：一键启动参数设置有误，找不到McPatchClient.jar文件

`解决方法`：检查JVM参数是否设置正确，McPatchClient.jar是否放到了正确位置

McPatchClient.jar需要放到`.minecraft/`目录下（如果未开启版本隔离），或者放到`.minecraft/versions/your-version/`目录下（如果开启了版本隔离）

### JavaAgent+Https下载限速问题

`影响范围`：客户端全版本

`问题原因`：问题源头目前未知

`解决方法`：使用HTTP协议而非HTTPS协议可以解决下载限速的问题，或者使用SFTP源，和Webdav源

### 连接被拒绝

`影响范围`：客户端全版本

`问题原因`：由于网络原因，服务器拒绝了客户端的HTTP TCP请求。俗话叫端口不通

`解决方法`：这不是程序bug，请排查与服务器直接的网络是否通常，是否需要放开安全组规则，配置端口映射，放行服务器防火墙规则，也请检查客户端配置文件中的地址是否填写错误等

如果你的服务端有公网地址，请检查客户端报错提示框中的地址是否含有localhost等字样，如果有，将其修改成你的公网IP地址再重试

### 连接超时

`影响范围`：客户端全版本

`问题原因`：由于网络原因，服务器未能在指定时间内及时应答客户端的HTTP TCP数据包。可能是网络不稳定也可能端口不通

`解决方法`：这不是程序bug，请检查客户端与服务器之间的网络是否稳定

如果你的服务端有公网地址，请检查客户端报错提示框中的地址是否含有localhost等字样，如果有，将其修改成你的公网IP地址再重试

### 连接中断

`影响范围`：客户端全版本

`问题原因`：由于网络原因，已建立的HTTP TCP连接被意外断开。俗话叫网络不稳定

`解决方法`：这不是程序bug，请检查客户端与服务器之间的网络是否流畅

### HTTP状态码不在2xx-3xx之间

`影响范围`：客户端全版本

`问题原因`：访问对应URL时，服务端返回了一个表示错误的HTTP状态码（即不在2xx-3xx之间）

`解决方法`：如果是HTTP(s)源，用浏览器打开这个出错的URL，根据浏览器的错误信息自行解决。如果是Webdav源，请向我报告此问题

### Webdav连接失败

`影响范围`：客户端1.0.9版或以上

`问题原因`：由于网络原因，Webdav服务器源出现了网络连接层面的错误

`解决方法`：这不是程序bug，此时需要根据报错信息后面的状态详情来定位具体原因

### 与图书馆模组librarianlib的兼容性问题

客户端程序使用Kotlin编写，并打包了Kotlin标准库。和图书馆模组同时加载时，可能会出现问题

`影响范围`：客户端全版本

`问题原因`：截止撰写本条目时，因为图书馆使用了较旧的Kotlin标准库版本（1.3），本程序使用（1.7）版本，直接可能会出现冲突

`解决方法`：此问题无法解决，只能等待图书馆模组将自带的Kotlin标准库升级到较新的版本来解决

题外话：截止撰写本条目时，图书馆模组的GitHub Issue里也有不少人反馈这个问题，但似乎这个模组很久未更新了

### McPatchClient是否可以自己更新自己

`问题描述`：McPatchClient是否可以通过把自身文件加入到更新中来实现自己更新自己？

`问题解答`：不可以，因为Windows不允许对运行中的文件进行读写，故无法更新自己

`小小提示`：虽然不可以更新客户端程序本身，但是更新配置文件`config.yml`是允许的，但缺点是第二次启动时新的配置文件才会生效

### 另一个程序已锁定文件的一部分，进程无法访问

java.io.IOException：另一个程序已锁定文件的一部分，进程无法访问

`影响范围`：客户端全版本

`问题原因`：Windows不允许对一个正在运行中的文件进行读写操作

`解决方法`：如果你使用JavaAgent启动，请不要更新游戏核心文件，游戏资源文件等可能与McPatchClient同时处于运行中的文件。如果你未使用JavaAgent启动，请检查Minecraft进程是否退出再更新

### 配置文件中的选项(xxx)无效

`影响范围`：客户端全版本

`问题原因`：配置文件`config.yml`中找不到名为xxx的配置项，或者配置项的数据类型不正确

`解决方法`：删除配置文件并重新从文件内部解压重新配置一次

### 配置文件无法解码为yaml格式

`影响范围`：客户端全版本

`问题原因`：配置文件语法错误导致无法解码

`解决方法`：检查配置文件格式是否正确，注释，缩进，忘打逗号等都会引发这个错误。如果仍然遇到这个错误，请先备份现有的配置文件，然后重新从Jar文件里解压官方示例配置文件，并一步步修改，直到定位到错误位置为止（也叫排除法）

### mc-patch.json无法解码为版本Meta文件格式

`影响范围`：客户端全版本

`问题原因`：更新包的元数据文件`.mc-patch.json`格式不正确，无法解码。此问题多出现在SakuraFrp穿透场景中

`解决方法`：如果你使用了SakuraFrp，且报错信息中包含`<!DOCTYPE html>`加跟着一长串乱码的话，请检查你的SakuraFrp穿透是否出了问题。如果你没有使用SakuraFrp，请向我报告此问题。

### 找不到.minecraft目录

即使把Jar客户端放到`.minecraft`目录旁也提示找不到的问题

`影响范围`：客户端全版本

`问题原因`：启动Jar文件时，在`打开方式`中选择了以Java启动打开，而非默认Java启动

`解决方案`：将Jar文件设置为默认使用Java运行，然后使用双击方式启动

### 无法确定版本前后关系

`影响范围`：客户端全版本

`问题原因`：客户端的版本号在服务端的mc-patch-versions.txt文件里找不到，可能是删掉了某个版本更新包导致

`解决方法`：

1. 让玩家删掉并重新下载一份群文件里的客户端压缩包（十分推荐，省时省力）
2. 删除客户端的`mc-patch-client-version.txt`文件使其重新下载所有的版本更新包（谨慎操作，此行为非常消耗流量）
3. 修改客户端的`mc-patch-client-version.txt`文件，输入一个服务端存在的有效版本号（谨慎操作，可能会导致对某些文件的后续更新直接失效）

### 版本的补丁文件的(xxx)已损坏

`影响范围`：客户端全版本

`问题原因`：更新包文件(.bin)里的某个文件二进制数据无法通过哈希校验，可能是文件下载时收到了损坏

`解决方法`：多次重试更新过程

### 主机指纹不可信任

`影响范围`：客户端全版本

`问题原因`：SFTP源的服务器字符串中指定的指纹和远程主机报告的指纹不一致，可能出现中间人攻击

`解决方法`：请自行确认远程主机是否可信，如果可信，请更新SFTP源的服务器字符串中的指纹部分

### 无效的sftp服务器字符串

`影响范围`：客户端全版本

`问题原因`：SFTP源的服务器字符串的格式不正确

`解决方法`：请仔细阅读配置文件注释和文档，修改服务器字符串的格式。如果仍然遇到这个错误，请先备份现有的配置文件，然后重新从Jar文件里解压官方示例配置文件，并一步步修改，直到定位到错误位置为止（也叫排除法）

### 无效的webdav服务器字符串

`影响范围`：客户端1.0.9版或以上

`问题原因`：Webdav源的服务器字符串的格式不正确

`解决方法`：请仔细阅读配置文件注释和文档，修改服务器字符串的格式

### SFTP 身份验证失败

`影响范围`：客户端全版本

`问题原因`：SFTP源的服务器字符串中的用户名或者密码不正确，无法登录SSH

`解决方法`：将服务器字符串中的用户名和密码修改正确

### SFTP Client 打开失败

`影响范围`：客户端全版本

`问题原因`：SSH已经登录成功，但是无法开启SFTP通信，可能是服务端SSH不支持SFTP协议

`解决方法`：更换SSH服务端软件

### SFTP 下载文件失败

`影响范围`：客户端全版本

`问题原因`：通过SFTP下载文件时遇到错误

`解决方法`：可能是网络原因导致。具体问题原因请看程序报告的错误信息内容

### 服务器SSL证书无法验证

`影响范围`：客户端1.0.9版或以上

`问题原因`：Webdav源的服务器SSL证书无法通过验证，可能是证书已过期，也可能网络被劫持

`解决方法`：更新服务器证书，并且用浏览器打开未显示证书错误后重新使用McPatchClient重试

为安全起见，McPatch无法跳过Webdav源的SSL证书验证过程，也就是说几乎是不支持自签证书的

### 找不到任何更新服务器地址

`影响范围`：客户端全版本

`问题原因`：客户端配置文件中的server选项不要写一个空列表，这样无法更新任何文件

`解决方法`：客户端配置文件中的server选项不要留空

### 未知格式的服务器字符串

`影响范围`：客户端全版本

`问题原因`：客户端配置文件中的server选项中的某一项因为格式不正确而无法解析

`解决方法`：仔细阅读示例格式，并对照检查错误。如果仍然遇到这个错误，请先备份现有的配置文件，然后重新从Jar文件里解压官方示例配置文件，并一步步修改，直到定位到错误位置为止（也叫排除法）
