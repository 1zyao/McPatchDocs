## 安装教程

### 创建第一个版本

1. 在桌面新建一个目录叫mp，将McPatchManage.jar和MiniHttpServer.jar复制进去
2. 在mp目录下新建一个文本文件manage.bat，粘贴`java -jar xxx.jar`进去（xxx换成McPatchManage.jar实际文件名）
3. 创建workspace目录，将客户端的.minecraft目录直接复制到mp/workspace/目录下面像这样：mp/workspace/.minecraft（注意仅复制.minecraft目录，启动器文件不要复制）
   1. 如果你打算今后只更新mods目录，不会更新其它文件，那么可以只复制`mp/workspace/.minecraft/mods`目录来缩减大小
4. 复制好之后，双击运行刚创建的manage.bat文件，输入1+Enter来开始创建第一个更新包
5. 提示要输入版本号之后，你就可以随便输入第一个版本号了，比如1.0，然后按Enter
   1. 版本号只能包括大小写字母，以及这些字符`!@#$%^&()_+-=[]{};',.`也不要出现中文或者空格
6. 然后程序会列出你对哪些文件做了更改。因为我们是第一次打更新包，文件数量可能较多，粗略看一下就好
7. 如果你需要写一些更新记录以在玩家更新此版本时弹出提示框的话，可以在此时打开changelogs.txt文件粘贴进去并保存
8. 一切妥当之后，输入y+Enter开始打包。首次打包内容较大，可能会花费相当多的时间，请耐心等待
9. 待到出现“创建版本完成”的字样后，就说明打包成功了（更新包文件会保存在public目录下）

### 开启HttpServer

1. 在mp目录下新建一个文本文件httpserver.bat，粘贴`java -jar xxx.jar`进去（xxx换成MiniHttpServer.jar实际文件名）
2. 双击运行httpserver.bat，启动成功后复制API地址，粘贴到浏览器打开，如果一切顺利浏览器会显`FORBIDDEN: Directory is unable to show`
3. 如果你需要从外网进行访问，把这个地址换成外网IP或者域名再访问一次，确保可以顺利访问

### 安装客户端

1. 复制一份你的服务器客户端文件夹到桌面上，并打开这个目录
2. 把McPatchClient.jar复制到.minecraft目录的旁边
3. 用压缩软件打开McPatchClient.jar，把config.yml文件解压出来，打开config.yml文件进行编辑
4. 将服务端的API地址粘贴到config.yml中的server选项后面，然后保存关闭
5. 双击运行McPatchClient.jar开始更新刚刚打包的第一个版本，这个过程可能会花费相当长的时间，请耐心等待
6. 更新完成后检查一下mc-patch-version.txt这个文件的内容，如果是1.0或者你刚创建的版本号，就说明第一个版本更新完毕
   1. 如果你要移动McPatchClient.jar的位置，请带着mc-patch-version.txt一起移动
7. 到此客户端配置完毕，如果希望在游戏启动时自动弹出更新，而不是每次都手点，可以参考一键启动的页面
8. 目前一键启动仅支持：[Windows平台](javaagent-windows.md)和[Android平台](javaagent-android.md)
9. 如果你确定config.yml已经调试完成，可以将config.yml打包回McPatchClient.jar里，然后删除外部的config.yml，程序会自动读取Jar内部的配置文件，以保持目录整洁

### 后续发布新版

1. 后续发布新版本很简单，只需要对workspace目录下的文件做修改，然后打出更新包就行，非常简单
2. 比如我想要删除客户端的一个模组a.jar再添加一个新的模组b.jar，那么只需要在workspace目录下删掉a.jar然后复制进去b.jar，接着打包新版本就好
3. 如果新旧文件同名，但文件内容被修改了也只一样的做法：直接覆盖旧文件就好，程序也能自动检测到
4. 对目录的新建和删除也是一样，该怎么新建怎么新建，该什么删除怎么删除，就和对“本地文件”进行这些操作一样
5. 如果你在workspace目录改了一些文件，但又觉得不妥，想要丢弃这些修改，可以启动管理端McPatchManage.jar，输入4+Enter来还原

## 一些使用小提示

### 目录用途说明

1. history目录：用来作为对比，以计算你对workspace目录做了哪些修改的目录
   1. 这个目录正常情况下和workspace目录里的文件一致，当你修改了workspace目录下的文件通过history目录进行对比就能算出你改了哪些文件目录
   2. history目录下的内容由程序自动维护，千万不要手动修改history目录下的文件，否则程序计算出来的二进制文件差异内容会出现差错，导致客户端无法更新到新版本
   3. 若不小心修改了history目录的文件，可以参考[这里](#不小心修改了history目录)来修复
2. public目录：用来存放打好的更新包，每个更新包有2个文件：二进制数据文件(.bin)和元数据文件(.json)，还有一个版本列表文件mc-patch-versions.txt
   1. 如果在一个版本中你仅做了删除文件，删除目录，新建目录的操作，同时又没有进行任何修改文件和新增文件的时候，最终打出来的更新包就只会包含一个json文件，而没有bin文件，这是正常现象
3. worksapce目录：用来日常维护客户端文件内容的目录，要对客户端做更新可以直接对整个文件做修改，然后打出更新包，客户端就会自动更新到新版本了

### 自由化部署

如果你不想使用MiniHttpServer.jar，而是希望使用自己的方式提供HTTP文件服务，比如Nginx，Apache，网站主机，对象存储等，那么只需要复制public目录的里面的文件就好，然后就可以删掉可以MiniHttpServer.jar文件了

当你打出一个新的更新包之后，并不需要把所有的版本文件都复制到你的Nginx，Apache，网站主机，对象存储之类的地方上，而是只需要复制那一个版本就好

比如我打了一个新版本叫10.0，那么就只用复制或者上传`10.0.mc-patch.json`和`10.0.mc-patch.bin`这两个文件，外加一个`mc-patch-versions.txt`文件到你自己的HTTP服务器空间上就好

在客户端填写server选项时，就需要填写你自己的URL，URL填写更新包所在的目录就行（就是.json文件和.bin文件所在的目录），而非指向具体文件名。具体文件名会由程序自动补全

### 版本号并非判断新旧的依据

版本号并未规定一定要往高迭代，也可以往低迭代，就是说你可以1.5版本更新到1.4版本，这都被允许的

因为版本的前后关系并不是直接判断版本号文字计算出来的，而是按照你打每个版本的时间顺序，后打的版本总是比先打的版本要新。版本号只是个标签罢了，不作为任何判断版本前后的依据

### 版本发错了怎么办

版本号一旦发布就不能撤回，撤回可能会导致客户端某些文件更新永久更新失败，而且这种问题很难发现和调试。你应该额外再发布一个版本来替代撤回

如果你100%确定刚发布的错误版本没有任何人下载的话，可以使用以下方法来撤回：

1. 打开public/mc-patch-versions.txt文件，将错误的版本那一行删除掉（其它行千万别改动）
2. 注意撤回不要只撤回中间的版本，应该连带撤回后续所有的新版本，比如现在有“甲乙丙丁戊”五个版本，如果“丙”版本需要撤回，应该连带“丙丁戊”一起撤回
3. 删除public目录下，错误的版本号的json文件和bin文件（同样连带后续所有版本）
4. 运行管理端，在主菜单输入bv+Enter进入隐藏的回溯菜单，回溯workspace目录和history目录的内容
5. 这样就回退到了你发布错误版本号之前的状态了
6. 如果你不能100%保证没有任何人下载过这个错误的版本，就不要撤回版本，否则那个人会出现各种各样的奇奇怪怪的问题

### 不小心修改了history目录

如果你不小心修改了history目录下的内容，可以在主菜单输入bv+Enter进入隐藏的回溯菜单来同时还原workspace目录和history目录，注意使用此命令前请三思，如使用不当可能会误删重要文件
